function toRad(e){return e*Math.PI/180}function Address(e,t,n,r){function i(){return this.street+" "+this.city+" "+this.state+" "+this.zip}this.street=e;this.city=t;this.state=n;this.zip=r;this.getFormatted=i}var homeLocation={get:function(){var e={};e.lat=localStorage.getItem("lat");e.lon=localStorage.getItem("lon");return e},set:function(e,t){localStorage.setItem("lat",e);localStorage.setItem("lon",t)}},locationPage={getLocation:function(){console.log("locationPage.getLocation Fired");navigator.geolocation.getCurrentPosition(this.getLocationSuccess,this.getError)},getLocationSuccess:function(e){console.log("locationPage.getLocationSuccess Fired");$("#lat").html(e.coords.latitude);$("#lon").html(e.coords.longitude);console.log(this);locationPage.doReverseLookup(e)},getError:function(e){console.log("getError Fired");console.log(e)},doReverseLookup:function(e){console.log("locationPage.doReverseLookup Fired");var t=e.coords.latitude+","+e.coords.longitude;$.ajax({url:"https://maps.googleapis.com/maps/api/geocode/json?sensor=false&latlng="+t,success:locationPage.doReverseLookupSuccess})},doReverseLookupSuccess:function(e){console.log("locationPage.doReverseLookupSuccess Fired");console.log(e);var t=e.results[0];$("#address").html(t.formatted_address)}},distancePage={setDistanceReadout:function(e,t){$("#d_km").html(e);$("#d_miles").html(t)},setDevicePosition:function(e,t){$("#lat-device").html(e);$("#lon-device").html(t)}},distanceModule={getLocation:function(){navigator.geolocation.getCurrentPosition(distanceModule.getLocationSuccess,distanceModule.getLocationError);console.log("getLocation Fired")},getLocationError:function(e){console.log("getLocationError Fired");console.log(e)},getLocationSuccess:function(e){var t=e.coords.latitude,n=e.coords.longitude,r=homeLocation.get(),i=r.lat,s=r.lon;distancePage.setDevicePosition(t,n);console.log("lat_device:",t);console.log("lon_device:",n);console.log("lat_home:",i);console.log("lon_home:",s);var o=Math.round(distanceModule.calcDistanceBetween(t,n,i,s)),u=Math.round(distanceModule.calcDistanceBetween(t,n,i,s,"miles"));distancePage.setDistanceReadout(o,u)},calcDistanceBetween:function(e,t,n,r,i){typeof i=="undefined"&&(i="km");var s=6371;i==="miles"&&(s=3958.7558657440545);var o=toRad(n-e),u=toRad(r-t),a=Math.sin(o/2)*Math.sin(o/2)+Math.cos(toRad(e))*Math.cos(toRad(n))*Math.sin(u/2)*Math.sin(u/2),f=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),l=s*f;return l}},settingsPage={reportHomeLocation:function(e,t){$("#lat").html(e);$("#lon").html(t)},getAddress:function(){var e=new Address;e.street=$("#address").val();e.city=$("#city").val();e.state=$("#state").val();e.zip=$("#zip").val();return e}},settings={computeHomeLocation:function(e){e.preventDefault();var t=settingsPage.getAddress();$.ajax({url:"https://maps.googleapis.com/maps/api/geocode/json?sensor=false&address="+t.getFormatted(),success:settings.doLookupSuccess})},setHomeLocationHere:function(e){e.preventDefault();navigator.geolocation.getCurrentPosition(settings.getLocationSuccess,settings.getLocationError)},getLocationSuccess:function(e){console.log("getLocationSuccess Fired");var t=e.coords.latitude,n=e.coords.longitude;homeLocation.set(t,n);settingsPage.reportHomeLocation(t,n)},getLocationError:function(e){console.log("getLocationError Fired");console.log(e)},doLookupSuccess:function(e){console.log(e.results[0].geometry.location);var t=e.results[0].geometry.location.lat,n=e.results[0].geometry.location.lng;homeLocation.set(t,n);settingsPage.reportHomeLocation(t,n)}},picturePage={displayImage:function(e){var t=document.getElementById("latest");t.src=e;t.style.display="inline"}},picture={onError:function(e){console.log(e.message)},getPicture:function(e){e.preventDefault();navigator.device.capture.captureImage(picture.onGetImageSuccess,picture.onError,{limit:1})},onGetImageSuccess:function(e){var t=e[0].fullPath;picturePage.displayImage(t)}};